
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Test Client</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; max-width: 800px; margin: 0 auto; padding: 20px; }
        #log { border: 1px solid #ccc; width: 100%; height: 300px; overflow-y: scroll; padding: 10px; margin-top: 10px; white-space: pre-wrap; }
        .controls, .login-controls, .play-controls { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        input[type="text"] { flex-grow: 1; padding: 5px; }
        button { padding: 5px 10px; }
    </style>
</head>
<body>
    <h2>WebSocket Test Client</h2>

    <div class="controls">
        <label for="url">URL:</label>
        <input type="text" id="url" value="ws://localhost:8080/ws">
        <button id="connect">Connect</button>
        <button id="disconnect" disabled>Disconnect</button>
    </div>

    <div class="login-controls">
        <label for="sid">SID:</label>
        <input type="text" id="sid" value="some_mock_token">
        <label for="gameId">GameID:</label>
        <input type="text" id="gameId" value="1000">
        <button id="login" disabled>Login</button>
    </div>

    <div class="play-controls" id="playControls" style="display: none;">
        <label for="betAmount">Bet Amount:</label>
        <input type="text" id="betAmount" value="10">
        <button id="play">Play</button>
    </div>

    <div id="log"></div>

    <script>
        const urlInput = document.getElementById('url');
        const connectBtn = document.getElementById('connect');
        const disconnectBtn = document.getElementById('disconnect');
        const sidInput = document.getElementById('sid');
        const gameIdInput = document.getElementById('gameId');
        const loginBtn = document.getElementById('login');
        const playControls = document.getElementById('playControls');
        const betAmountInput = document.getElementById('betAmount');
        const playBtn = document.getElementById('play');
        const logDiv = document.getElementById('log');

        let socket;

        function log(message) {
            const el = document.createElement('div');
            el.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(el);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        connectBtn.onclick = () => {
            const url = urlInput.value;
            socket = new WebSocket(url);

            socket.onopen = () => {
                log('---> Connected to server');
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                loginBtn.disabled = false;
                playControls.style.display = 'none';
            };

            socket.onmessage = (event) => {
                log(`<-- Received: ${event.data}`);
                if (event.data.includes("authenticated successfully")) {
                    playControls.style.display = 'flex';
                }
            };

            socket.onclose = (event) => {
                log(`---> Disconnected. Code: ${event.code}, Reason: ${event.reason}`);
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                loginBtn.disabled = true;
                playControls.style.display = 'none';
            };

            socket.onerror = (error) => {
                log(`*** Error: A connection error occurred.`);
            };
        };

        disconnectBtn.onclick = () => {
            if (socket) {
                socket.close();
            }
        };

        loginBtn.onclick = () => {
            if (!socket || socket.readyState !== WebSocket.OPEN) {
                log('*** Not connected.');
                return;
            }
            const sid = sidInput.value;
            const gameId = gameIdInput.value;
            const loginMsg = {
                action: "login",
                data: {
                    sid: sid,
                    gameId: parseInt(gameId)
                }
            };
            const msgStr = JSON.stringify(loginMsg);
            log(`--> Sending: ${msgStr}`);
            socket.send(msgStr);
        };

        playBtn.onclick = () => {
            if (!socket || socket.readyState !== WebSocket.OPEN) {
                log('*** Not connected.');
                return;
            }
            const betAmount = betAmountInput.value;
            const playMsg = {
                action: "play",
                data: {
                    betAmount: betAmount
                }
            };
            const msgStr = JSON.stringify(playMsg);
            log(`--> Sending: ${msgStr}`);
            socket.send(msgStr);
        };

    </script>
</body>
</html>
